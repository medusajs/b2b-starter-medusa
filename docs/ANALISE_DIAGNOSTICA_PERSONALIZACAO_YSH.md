# üìä An√°lise Diagn√≥stica: Personaliza√ß√£o End-to-End YSH Solar

**Data:** 7 de Outubro de 2025  
**Projeto:** YSH B2B Medusa Solar Marketplace  
**Status:** üî¥ Implementa√ß√£o Parcial - Requer Corre√ß√µes Cr√≠ticas

---

## üéØ Executive Summary

A personaliza√ß√£o YSH Solar est√° **parcialmente implementada** com **componentes frontend customizados**, mas apresenta **gaps cr√≠ticos** na integra√ß√£o backend e problemas de build que impedem deployment em produ√ß√£o.

### M√©tricas Gerais

- ‚úÖ **Base B2B Starter**: Instalado e configurado
- ‚ö†Ô∏è **Cat√°logo YSH**: 1.161 produtos preparados (n√£o integrados)
- üî¥ **Build Storefront**: Falhando (14 erros + 2 warnings)
- üî¥ **Backend Solar Module**: N√£o implementado
- ‚ö†Ô∏è **Database**: Kubernetes local (n√£o Docker Compose configurado)

---

## üì¶ 1. INVENT√ÅRIO DE ATIVOS PRONTOS

### 1.1 Cat√°logo de Dados (‚úÖ 100% Pronto)

#### Produtos Consolidados

```json
{
  "total_products": 1161,
  "categories": {
    "kits": 336,           // ‚≠ê Principal: 247 FOTUS + hibridos
    "inverters": 490,      // DEYE, TSUNESS, outros
    "cables": 55,
    "panels": 29,          // ASTRONERGY, TRINA, SOLAR N PLUS
    "ev_chargers": 83,
    "structures": 40,
    "controllers": 38,
    "accessories": 17,
    "stringboxes": 13,
    "batteries": 9,
    "posts": 6,
    "others": 45
  }
}
```

#### Schemas Unificados (‚úÖ Excelente)

**Localiza√ß√£o**: `data/catalog/unified_schemas/`

- ‚úÖ `panels_unified.json` - 2.893 linhas, specs t√©cnicas completas
- ‚úÖ `kits_unified.json` - 26.981 linhas, componentes detalhados
- ‚úÖ `inverters_unified.json` - Completo com especifica√ß√µes
- ‚úÖ `MASTER_INDEX.json` - √çndice consolidado
- ‚úÖ `CONSOLIDATION_METADATA.json` - Rastreabilidade

**Qualidade dos Dados**:

```javascript
// Exemplo: Panel Schema
{
  "id": "odex_inverters_ODEX-PAINEL-ODEX-585W",
  "name": "Painel Solar Odex 585W",
  "manufacturer": "Odex",
  "category": "panels",
  "price": "R$ 490,00",
  "processed_images": {
    "thumb": "catalog\\images_processed\\...",
    "medium": "...",
    "large": "..."
  },
  "technical_specs": {
    "power_w": 585,
    "technology": "Monocristalino",
    "efficiency": 585.0
  },
  "metadata": {
    "normalized": true,
    "normalized_at": "2025-10-07T05:03:13"
  }
}

// Exemplo: Kit Schema
{
  "id": "FOTUS-KP04-kits-hibridos",
  "name": "KP04 - ASTRONERGY 600W + TSUNESS 2.25KW",
  "potencia_kwp": 1.2,
  "price_brl": 2706.07,
  "panels": [
    {
      "brand": "ASTRONERGY",
      "power_w": 600,
      "quantity": 2
    }
  ],
  "inverters": [
    {
      "brand": "TSUNESS",
      "power_kw": 2.25,
      "quantity": 1
    }
  ],
  "processed_images": { /* completo */ }
}
```

### 1.2 Imagens Processadas (‚úÖ 88.7% Cobertura)

- ‚úÖ **WebP otimizado** (3 tamanhos: thumb/medium/large)
- ‚úÖ **Upscaling IA** para imagens baixa qualidade
- ‚úÖ Estrutura: `catalog/images_processed/[DISTRIBUTOR]/[CATEGORY]/`

---

## üèóÔ∏è 2. ARQUITETURA IMPLEMENTADA

### 2.1 Backend: Medusa B2B Starter (‚úÖ Base + ‚ö†Ô∏è Solar Gaps)

#### M√≥dulos B2B Nativos (‚úÖ Funcionais)

```typescript
// medusa-starter/backend/medusa-config.ts
modules: {
  [COMPANY_MODULE]: { resolve: "./modules/company" },     // ‚úÖ
  [QUOTE_MODULE]: { resolve: "./modules/quote" },         // ‚úÖ
  [APPROVAL_MODULE]: { resolve: "./modules/approval" },   // ‚úÖ
  // üî¥ SOLAR_MODULE: FALTANDO
}
```

**Funcionalidades B2B Ativas**:

- ‚úÖ Company Management (empresas + funcion√°rios)
- ‚úÖ Spending Limits (limites de gastos)
- ‚úÖ Quote System (cota√ß√µes completas)
- ‚úÖ Approval Workflows (aprova√ß√µes configur√°veis)
- ‚úÖ Order Edit (edi√ß√£o de pedidos)

#### üî¥ **CR√çTICO: M√≥dulo Solar Ausente**

```bash
# Estrutura esperada (N√ÉO EXISTE):
backend/src/modules/solar-products/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ solar-panel.ts
‚îÇ   ‚îú‚îÄ‚îÄ solar-inverter.ts
‚îÇ   ‚îú‚îÄ‚îÄ solar-kit.ts
‚îÇ   ‚îî‚îÄ‚îÄ solar-structure.ts
‚îú‚îÄ‚îÄ service.ts
‚îú‚îÄ‚îÄ index.ts
‚îî‚îÄ‚îÄ migrations/
```

**Impacto**:

- ‚ùå Produtos solares n√£o podem ser cadastrados com specs t√©cnicas
- ‚ùå C√°lculos de dimensionamento sem backend
- ‚ùå Filtros t√©cnicos dependem apenas de frontend

### 2.2 Storefront: Next.js 15 (‚ö†Ô∏è Customizado mas com Erros)

#### Componentes Customizados Implementados (‚úÖ)

```bash
storefront/src/modules/home/components/
‚îú‚îÄ‚îÄ hero/index.tsx              # ‚úÖ Hero YSH com "Energia Solar sob Medida"
‚îú‚îÄ‚îÄ solar-stats/index.tsx       # üî¥ CORRUPTO (c√≥digo duplicado)
‚îú‚îÄ‚îÄ testimonials/index.tsx      # ‚úÖ Depoimentos YSH
‚îî‚îÄ‚îÄ features/                   # ‚úÖ Features solares

storefront/src/app/[countryCode]/(main)/
‚îú‚îÄ‚îÄ dimensionamento/page.tsx    # ‚úÖ Calculadora solar UI
‚îú‚îÄ‚îÄ produtos/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx               # ‚úÖ Cat√°logo customizado
‚îÇ   ‚îî‚îÄ‚îÄ kits/page.tsx          # ‚úÖ Listagem kits
```

#### üî¥ **ERROS CR√çTICOS DE BUILD**

##### Erro 1: Importa√ß√µes Stripe Removidas (14 ocorr√™ncias)

```typescript
// storefront/src/lib/constants.tsx
// ‚ùå REMOVIDO (causa erros em checkout):
// export const isStripe = (providerId?: string) => ...

// storefront/src/modules/checkout/components/payment/index.tsx
// ‚ùå Importando fun√ß√£o inexistente:
import { isStripe as isStripeFunc } from '@/lib/constants'

// storefront/src/modules/checkout/components/payment-wrapper/index.tsx
// ‚ùå Exportando contexto inexistente:
// export const StripeContext = ...
```

**Root Cause**: Stripe removido para evitar conflitos de depend√™ncia, mas c√≥digo n√£o foi refatorado.

##### Erro 2: √çcones Lucide vs Medusa Icons (4 ocorr√™ncias)

```typescript
// storefront/src/modules/home/components/hero/index.tsx
import { Calculator, Zap } from '@medusajs/icons'  // ‚ùå N√£o existem

// ‚úÖ CORRE√á√ÉO: usar lucide-react
import { Calculator, Zap } from 'lucide-react'
```

##### Erro 3: Links HTML vs Next.js Link (10 ocorr√™ncias)

```tsx
// storefront/src/app/[countryCode]/(main)/produtos/page.tsx:181
<a href="/dimensionamento/">  // ‚ùå ESLint error
  Fazer Dimensionamento
</a>

// ‚úÖ CORRE√á√ÉO:
<Link href="/dimensionamento">...</Link>
```

##### Erro 4: Hooks Condicionais (5 ocorr√™ncias)

```typescript
// storefront/src/modules/checkout/components/contact-details/index.tsx:23
if (condition) {
  const searchParams = useSearchParams()  // ‚ùå Hook condicional
}

// ‚úÖ CORRE√á√ÉO: mover hooks para topo do componente
```

##### Erro 5: Arquivo Bin√°rio Corrompido (1 ocorr√™ncia)

```bash
./src/modules/home/components/solar-stats/index.tsx
Error: Parsing error: File appears to be binary.
```

**Root Cause**: C√≥digo duplicado malformado (linhas duplicadas vis√≠veis no arquivo).

---

## üóÑÔ∏è 3. ESTADO DA INFRAESTRUTURA

### 3.1 Database Setup (‚ö†Ô∏è N√£o Padr√£o)

#### Configura√ß√£o Esperada (Docker Compose)

```yaml
# docker-compose.yml
services:
  postgres:
    image: postgres:16-alpine
    ports: ["5432:5432"]
    environment:
      POSTGRES_DB: medusa_db
      POSTGRES_USER: medusa_user
      POSTGRES_PASSWORD: medusa_password
```

#### Configura√ß√£o Atual (üî¥ Kubernetes Local)

```bash
$ docker ps | grep postgres
k8s_postgres_supabase-db-5477448b9d-b7ddf_ysh_c8e5db76...

# Database no Kubernetes (n√£o gerenciado por Docker Compose)
```

**Problemas**:

1. ‚ùå `docker-compose up` falha com conflito de rede
2. ‚ö†Ô∏è Backend configurado para `localhost:5432` (porta Kubernetes)
3. ‚úÖ Backend conseguiu iniciar dev server (indica conex√£o OK)

### 3.2 Environment Variables

#### Backend (.env - ‚úÖ Configurado)

```bash
DATABASE_URL=postgres://medusa_user:medusa_password@localhost:5432/medusa_db
REDIS_URL=redis://localhost:6379
JWT_SECRET=supersecret
COOKIE_SECRET=supersecret
STORE_CORS=http://localhost:8000
ADMIN_CORS=http://localhost:7000
```

#### Storefront (.env - ‚ö†Ô∏è Parcial)

```bash
# ‚úÖ Configurado:
NEXT_PUBLIC_MEDUSA_BACKEND_URL=http://localhost:9000

# ‚ùå FALTANDO (cr√≠tico para build):
NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY=???
NEXT_PUBLIC_PAYPAL_CLIENT_ID=???
```

---

## üé® 4. DESIGN SYSTEM YSH

### 4.1 Implementa√ß√£o (‚úÖ Completo)

#### Cores da Marca

```css
/* storefront/src/styles/design-system.css */
:root {
  --ysh-yellow-50: #fffdf0;
  --ysh-yellow-400: #ffc107;   /* Principal */
  --ysh-yellow-500: #ffb300;
  --ysh-blue-600: #1e3a8a;     /* Secund√°rio */
  --ysh-gray-900: #111827;     /* Texto */
}
```

#### Componentes Customizados

```typescript
// storefront/src/lib/design-system/components/
‚îú‚îÄ‚îÄ Button.tsx          // ‚úÖ ysh-btn-primary, ysh-btn-secondary
‚îú‚îÄ‚îÄ Card.tsx            // ‚úÖ ysh-card-solar (gradiente)
‚îú‚îÄ‚îÄ Badge.tsx           // ‚úÖ ysh-badge-efficiency
‚îî‚îÄ‚îÄ Input.tsx           // ‚úÖ ysh-input com valida√ß√£o
```

#### Classes Utilit√°rias

```css
.ysh-price {
  @apply text-3xl font-bold text-yello-yellow-500;
}

.ysh-heading {
  @apply text-4xl font-bold text-gray-900;
}

.ysh-gradient-solar {
  @apply bg-gradient-to-r from-yello-yellow-400 to-yello-yellow-500;
}
```

### 4.2 Integra√ß√£o (‚úÖ Aplicado em P√°ginas)

- ‚úÖ Hero component usa gradiente YSH
- ‚úÖ Bot√µes CTAs com cores da marca
- ‚úÖ Cards de produtos com estilo solar
- ‚úÖ Testimonials com identidade YSH

---

## üìä 5. ROTAS CUSTOMIZADAS

### 5.1 Rotas Solares Implementadas (‚úÖ UI + üî¥ Backend)

#### `/dimensionamento` (‚úÖ UI Completo)

**Componente**: `app/[countryCode]/(main)/dimensionamento/page.tsx`

**Features**:

- ‚úÖ Upload de conta de luz
- ‚úÖ Formul√°rio de consumo manual
- ‚úÖ Sele√ß√£o de tipo de instala√ß√£o
- ‚úÖ Cards de benef√≠cios (70-90% economia, 25 anos garantia)
- ‚úÖ Explica√ß√£o do processo (4 etapas)

**‚ùå Faltando Backend**:

```typescript
// API n√£o implementada:
POST /api/solar/calculate-system
{
  consumption_kwh: 350,
  installation_type: "telhado_ceramico",
  location: { lat, lng }
}
// Deveria retornar: pot√™ncia necess√°ria, kits recomendados
```

#### `/produtos` (‚úÖ UI + ‚ö†Ô∏è Data Loading)

**Componente**: `app/[countryCode]/(main)/produtos/page.tsx`

**Features**:

- ‚úÖ Server Components com ISR (revalidate: 3600s)
- ‚úÖ Suspense boundaries
- ‚úÖ Lazy loading (dynamic imports)
- ‚úÖ Skeleton loaders

**üî¥ Problema**: Carrega de arquivos JSON locais

```typescript
// ‚ùå M√©todo atual (n√£o escal√°vel):
const catalogPath = path.join(process.cwd(), '../../../data/catalog')
const panelsData = await fs.readFile(catalogPath + '/panels.json')

// ‚úÖ Deveria usar Medusa API:
const panels = await sdk.admin.product.list({ category_id: 'panels' })
```

#### `/produtos/kits` (‚úÖ UI)

**Componente**: `app/[countryCode]/(main)/produtos/kits/page.tsx`

**Features**:

- ‚úÖ Metadata SEO otimizado
- ‚úÖ Filtros por pot√™ncia (n√£o funcional)
- ‚úÖ Grid responsivo

**‚ùå Filtros N√£o Funcionais**:

```typescript
// Filtros dependem de query params mas n√£o implementados:
const searchParams = useSearchParams()
const potencia = searchParams.get('potencia')  // ‚úÖ Captura
// ‚ùå N√£o aplica filtro (produtos hardcoded)
```

### 5.2 Rotas Faltando (üî¥ Cr√≠ticas)

#### `/api/solar/calculator` - Dimensionamento Backend

**Prioridade**: üî¥ ALTA

**Funcionalidade Esperada**:

```typescript
// POST /api/solar/calculator
interface CalculatorRequest {
  consumption_kwh: number
  location: string
  installation_type: string
  roof_area_m2?: number
}

interface CalculatorResponse {
  recommended_power_kwp: number
  recommended_kits: Kit[]
  estimated_savings_monthly: number
  payback_years: number
  co2_offset_tons_year: number
}
```

#### `/api/solar/kits/search` - Busca Avan√ßada

**Prioridade**: üü° M√âDIA

**Features Necess√°rias**:

- Filtros por pot√™ncia (kWp range)
- Filtros por fabricante (ASTRONERGY, DEYE, etc)
- Filtros por tipo (on-grid, h√≠brido, off-grid)
- Ordena√ß√£o (pre√ßo, pot√™ncia, efici√™ncia)

#### `/api/solar/products/compare` - Comparador

**Prioridade**: üü° M√âDIA

**Features**:

- Side-by-side de specs t√©cnicas
- Gr√°ficos de efici√™ncia
- ROI comparison

---

## üîó 6. INTEGRA√á√ÉO CAT√ÅLOGO ‚Üí MEDUSA

### 6.1 Script de Seed (‚ö†Ô∏è Incompleto)

#### Script Existente

```typescript
// backend/src/scripts/seed-catalog.ts
// ‚ùå N√ÉO IMPLEMENTADO para dados YSH
```

#### Script Necess√°rio

```typescript
// backend/src/scripts/seed-ysh-catalog.ts
import { readFileSync } from 'fs'
import { join } from 'path'

export default async function seedYSHCatalog({ container }) {
  const productService = container.resolve('productService')
  const productVariantService = container.resolve('productVariantService')
  
  // 1. Load unified schemas
  const schemasPath = '../../../data/catalog/unified_schemas'
  const panels = JSON.parse(readFileSync(join(schemasPath, 'panels_unified.json')))
  const kits = JSON.parse(readFileSync(join(schemasPath, 'kits_unified.json')))
  const inverters = JSON.parse(readFileSync(join(schemasPath, 'inverters_unified.json')))
  
  // 2. Create categories
  const categories = await createSolarCategories(container)
  
  // 3. Seed panels
  for (const panel of panels) {
    await productService.create({
      title: panel.name,
      description: panel.description,
      handle: slugify(panel.name),
      categories: [categories.panels.id],
      metadata: {
        manufacturer: panel.manufacturer,
        power_w: panel.technical_specs.power_w,
        efficiency: panel.technical_specs.efficiency,
        technology: panel.technical_specs.technology
      },
      variants: [{
        title: 'Default',
        sku: panel.id,
        prices: [{
          amount: panel.pricing.price * 100,  // centavos
          currency_code: 'brl'
        }]
      }],
      images: [
        { url: panel.processed_images.large }
      ]
    })
  }
  
  // 4. Seed kits (similar)
  // 5. Seed inverters (similar)
}
```

**Status**: üî¥ **N√ÉO IMPLEMENTADO**

### 6.2 Migration de Schemas

#### Modelo Solar Necess√°rio

```typescript
// backend/src/modules/solar-products/models/solar-panel.ts
import { model } from '@medusajs/framework/utils'

export const SolarPanel = model.define('solar_panel', {
  id: model.id().primaryKey(),
  product_id: model.text(),  // FK para Product
  
  // Specs t√©cnicas
  power_w: model.number(),
  efficiency_percent: model.number(),
  technology: model.text(),  // Monocristalino, Policristalino
  dimensions_mm: model.json(),  // { width, height, depth }
  weight_kg: model.number(),
  
  // Certifica√ß√µes
  certifications: model.json(),  // [IEC, TUV, etc]
  
  // Garantias
  warranty_years_product: model.number(),
  warranty_years_performance: model.number(),
  
  // Performance
  temp_coefficient: model.number(),
  max_system_voltage: model.number(),
})
```

**Status**: üî¥ **N√ÉO EXISTE**

---

## üß™ 7. TESTES E VALIDA√á√ÉO

### 7.1 Build Status

#### Storefront Build (üî¥ FALHANDO)

```bash
$ npm run build
‚úó 14 errors
‚ö† 2 warnings

Erros:
- 10x: Use <Link> instead of <a>
- 5x: React Hooks called conditionally
- 4x: Icons not exported from @medusajs/icons
- 2x: Missing exports (isStripe, StripeContext)
- 1x: Binary file error (solar-stats)
```

#### Backend Build (‚úÖ OK)

```bash
$ npm run dev
info: Watching filesystem...
‚úì Server started on port 9000
```

### 7.2 Checklist de Funcionalidade

#### Funcionalidades B2B (‚úÖ Herdadas)

- ‚úÖ Login/registro de empresas
- ‚úÖ Gest√£o de funcion√°rios
- ‚úÖ Limites de gastos
- ‚úÖ Sistema de cota√ß√µes
- ‚úÖ Aprova√ß√µes de pedidos
- ‚úÖ Carrinho bulk add

#### Funcionalidades Solares (‚ùå Maioria N√£o Funcional)

- ‚ùå Cadastro de produtos com specs solares
- ‚ùå Filtros t√©cnicos (pot√™ncia, efici√™ncia)
- ‚ùå Calculadora de dimensionamento (backend)
- ‚ùå ROI calculator
- ‚ùå Comparador de produtos
- ‚ùå Recomenda√ß√£o de kits por consumo
- ‚ö†Ô∏è Cat√°logo visual (UI pronta, dados locais)
- ‚ö†Ô∏è Upload de conta de luz (UI pronta, sem processamento)

---

## üö® 8. PROBLEMAS CR√çTICOS IDENTIFICADOS

### 8.1 Bloqueadores de Deploy (üî¥ P0)

#### 1. Storefront Build Failure

**Impacto**: Impossibilita deployment
**Esfor√ßo**: 2-4 horas
**A√ß√µes**:

```bash
1. Corrigir solar-stats/index.tsx (remover c√≥digo duplicado)
2. Substituir √≠cones Medusa por lucide-react (4 ocorr√™ncias)
3. Substituir <a> por <Link> (10 ocorr√™ncias)
4. Refatorar hooks condicionais (5 componentes)
5. Restaurar isStripe() ou remover todas refer√™ncias
```

#### 2. M√≥dulo Solar Backend Ausente

**Impacto**: Funcionalidades core n√£o funcionam
**Esfor√ßo**: 3-5 dias
**A√ß√µes**:

```bash
1. Criar backend/src/modules/solar-products/
2. Definir models (SolarPanel, SolarInverter, SolarKit)
3. Criar migrations
4. Implementar service layer
5. Expor APIs REST
```

#### 3. Cat√°logo N√£o Integrado

**Impacto**: 1.161 produtos n√£o dispon√≠veis no Medusa
**Esfor√ßo**: 2-3 dias
**A√ß√µes**:

```bash
1. Implementar seed-ysh-catalog.ts
2. Criar script de migra√ß√£o de imagens
3. Mapear schemas unificados ‚Üí Medusa Product
4. Executar seed (estimar 30min-2h para 1.161 produtos)
5. Validar integridade (pre√ßos, imagens, specs)
```

### 8.2 Funcionalidades Incompletas (üü° P1)

#### 1. Calculadora Solar

**Status**: UI pronta (80%) + Backend ausente (0%)
**Gap**: L√≥gica de dimensionamento, integra√ß√£o com cat√°logo

#### 2. Filtros T√©cnicos

**Status**: UI b√°sica (40%) + Sem backend filtering
**Gap**: Query params n√£o aplicam filtros, pagina√ß√£o ausente

#### 3. Comparador de Produtos

**Status**: N√£o implementado (0%)
**Gap**: Necess√°rio para B2B (comparar specs lado a lado)

### 8.3 D√≠vidas T√©cnicas (üü¢ P2)

#### 1. Performance

- ‚ö†Ô∏è Carregamento de JSON files (vs Medusa API)
- ‚ö†Ô∏è Sem cache de imagens no CDN
- ‚ö†Ô∏è Sem lazy loading de imagens pesadas

#### 2. SEO

- ‚ö†Ô∏è Metadata din√¢mica ausente (produtos individuais)
- ‚ö†Ô∏è Sitemap n√£o gerado
- ‚ö†Ô∏è Structured data (JSON-LD) ausente

#### 3. Testes

- ‚ùå Zero testes E2E
- ‚ùå Zero testes de integra√ß√£o
- ‚ùå Zero testes unit√°rios para l√≥gica solar

---

## üìã 9. PLANO DE A√á√ÉO RECOMENDADO

### 9.1 Sprint 1: Corre√ß√µes Cr√≠ticas (5 dias)

#### Dia 1-2: Fix Build Errors

```bash
Tarefa 1.1: Corrigir solar-stats component
- Remover c√≥digo duplicado
- Validar sintaxe
- Testar build

Tarefa 1.2: Refatorar payment components
- Op√ß√£o A: Restaurar Stripe support
- Op√ß√£o B: Remover todas refer√™ncias isStripe
- Atualizar payment-wrapper exports

Tarefa 1.3: Corrigir imports de √≠cones
- Substituir @medusajs/icons por lucide-react
- Verificar todos componentes

Tarefa 1.4: Fix ESLint errors
- Substituir <a> por <Link>
- Mover hooks para topo dos componentes
- Validar build limpo

‚úÖ Crit√©rio de Sucesso: npm run build passa sem erros
```

#### Dia 3-4: Implementar M√≥dulo Solar Backend

```typescript
// Estrutura m√≠nima funcional:
backend/src/modules/solar-products/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ solar-product.ts     // Extens√£o de Product
‚îú‚îÄ‚îÄ service.ts               // L√≥gica de neg√≥cio
‚îú‚îÄ‚îÄ index.ts
‚îî‚îÄ‚îÄ migrations/
    ‚îî‚îÄ‚îÄ 001_add_solar_specs.ts

// APIs m√≠nimas:
POST   /admin/solar-products          // Criar produto solar
GET    /store/solar-products          // Listar com filtros
GET    /store/solar-products/:id      // Detalhes
POST   /store/solar/calculate-system  // Dimensionamento
```

#### Dia 5: Seed Cat√°logo YSH

```bash
1. Implementar seed-ysh-catalog.ts
2. Migrar 336 kits priorit√°rios
3. Migrar top 50 pain√©is
4. Migrar top 50 inversores
5. Validar pre√ßos e imagens

‚úÖ Crit√©rio: 400+ produtos no Medusa Admin
```

### 9.2 Sprint 2: Funcionalidades Core (7 dias)

#### Dia 6-8: Calculadora Solar

```typescript
// Backend: L√≥gica de dimensionamento
POST /api/solar/calculate-system
- Calcular pot√™ncia necess√°ria
- Recomendar kits adequados
- Estimar economia

// Frontend: Integra√ß√£o
- Conectar formul√°rio √† API
- Exibir resultados dinamicamente
- Adicionar kits ao carrinho
```

#### Dia 9-10: Filtros e Busca

```typescript
// Backend: Query builder
GET /store/solar-products?
  power_min=500&
  power_max=600&
  manufacturer=ASTRONERGY&
  sort=price_asc

// Frontend: UI de filtros
- Sliders de pot√™ncia
- Checkboxes de fabricantes
- Ordena√ß√£o
```

#### Dia 11-12: Integra√ß√£o Completa

```bash
- Substituir JSON loads por SDK calls
- Implementar cache (Redis)
- Otimizar performance
- Testes E2E b√°sicos
```

### 9.3 Sprint 3: Polimento e Deploy (5 dias)

#### Dia 13-14: Comparador + ROI

```typescript
GET /store/solar/compare?ids=panel1,panel2,panel3
// Side-by-side de specs

GET /store/solar/roi-calculator?
  system_cost=25000&
  monthly_savings=350
// Proje√ß√£o de retorno
```

#### Dia 15-16: SEO e Performance

```bash
- Gerar sitemap din√¢mico
- Adicionar structured data
- Otimizar imagens (CDN)
- Lighthouse score > 90
```

#### Dia 17: Deploy e Valida√ß√£o

```bash
- Setup production database
- Deploy backend (AWS/Azure)
- Deploy storefront (Vercel)
- Smoke tests
- Handoff para cliente
```

---

## üìä 10. MATRIZ DE RISCO

| Risco | Probabilidade | Impacto | Mitiga√ß√£o |
|-------|--------------|---------|-----------|
| Build n√£o corrige em 2 dias | M√©dia | Alto | Alocar dev s√™nior, pair programming |
| Seed demora >4h (1.161 produtos) | Alta | M√©dio | Batch processing, paraleliza√ß√£o |
| Performance ruim com cat√°logo grande | M√©dia | M√©dio | Implementar pagina√ß√£o, cache agressivo |
| Cliente quer Stripe de volta | Baixa | Alto | Documentar remo√ß√£o, plano de restore |
| Kubernetes DB conflita com Docker | Baixa | Baixo | Migrar para Docker Compose standalone |

---

## üéØ 11. M√âTRICAS DE SUCESSO

### T√©cnicas

- ‚úÖ Build passa sem erros/warnings
- ‚úÖ 100% uptime backend dev server
- ‚úÖ <200ms response time APIs solares
- ‚úÖ 1.161 produtos no Medusa
- ‚úÖ 88.7% imagens carregando

### Funcionais

- ‚úÖ Calculadora retorna kits adequados em <2s
- ‚úÖ Filtros retornam resultados em <500ms
- ‚úÖ Comparador suporta 3+ produtos simultaneamente
- ‚úÖ Checkout B2B completo (quote ‚Üí order)

### Neg√≥cio

- ‚úÖ Demo pronto para stakeholders
- ‚úÖ Documenta√ß√£o completa (README, ARCHITECTURE.md)
- ‚úÖ Roadmap p√≥s-MVP definido

---

## üìÑ 12. ANEXOS

### 12.1 Comandos √öteis

```bash
# Backend
cd medusa-starter/backend
npm run dev              # Dev server
npm run seed:catalog     # Seed YSH (ap√≥s implementar)
npm run migrate          # Run migrations

# Storefront
cd medusa-starter/storefront
npm run dev              # Dev server
npm run build            # Production build
npm run lint             # ESLint check

# Database
docker-compose up -d postgres redis   # Start DB
docker-compose down                   # Stop all
```

### 12.2 Arquivos Cr√≠ticos

```bash
# Backend
medusa-config.ts                  # Configura√ß√£o Medusa
src/modules/solar-products/       # üî¥ CRIAR
src/scripts/seed-ysh-catalog.ts   # üî¥ CRIAR

# Storefront
src/modules/home/components/solar-stats/index.tsx   # üî¥ CORRIGIR
src/lib/constants.tsx                               # üî¥ CORRIGIR
src/app/[countryCode]/(main)/produtos/page.tsx     # ‚ö†Ô∏è REFATORAR

# Data
data/catalog/unified_schemas/     # ‚úÖ Pronto para uso
```

### 12.3 Contatos e Refer√™ncias

- **Medusa Docs**: <https://docs.medusajs.com/v2>
- **B2B Starter**: <https://github.com/medusajs/b2b-starter-medusa>
- **Next.js 15**: <https://nextjs.org/docs>
- **Lucide Icons**: <https://lucide.dev/>

---

## ‚úÖ CONCLUS√ÉO

### Status Atual: üü° **45% Completo**

#### O Que Est√° Funcionando (‚úÖ)

1. Base B2B Starter instalada e rodando
2. Design system YSH implementado
3. UI solar customizada (hero, stats, dimensionamento)
4. 1.161 produtos com schemas unificados
5. 88.7% imagens processadas e otimizadas

#### O Que Est√° Bloqueando Deploy (üî¥)

1. 14 erros de build no storefront
2. M√≥dulo solar backend ausente
3. Cat√°logo n√£o integrado ao Medusa
4. Calculadora sem backend funcional
5. Filtros t√©cnicos n√£o aplicam

#### Pr√≥ximos Passos Cr√≠ticos

1. **Hoje**: Corrigir erros de build (2-4h)
2. **Semana 1**: Implementar m√≥dulo solar backend (3-5 dias)
3. **Semana 2**: Seed cat√°logo + calculadora (5-7 dias)
4. **Semana 3**: Polimento e deploy (3-5 dias)

### Estimativa Realista para Produ√ß√£o

- **Otimista**: 15 dias √∫teis (3 sprints)
- **Realista**: 20 dias √∫teis (4 sprints)
- **Pessimista**: 25 dias √∫teis (5 sprints)

**Recomenda√ß√£o**: Iniciar Sprint 1 imediatamente, focando em desbloquear build e implementar m√≥dulo solar m√≠nimo vi√°vel.

---

**Documento gerado em**: 7 de Outubro de 2025, 08:30 BRT  
**√öltima atualiza√ß√£o**: An√°lise completa baseada em inspe√ß√£o end-to-end  
**Pr√≥xima revis√£o**: Ap√≥s Sprint 1 (corre√ß√µes cr√≠ticas)
