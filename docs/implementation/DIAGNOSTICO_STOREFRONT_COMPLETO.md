# üå≥ Estrutura e Diagn√≥stico do Storefront - Yello Solar Hub

**Data**: 8 de outubro de 2025  
**Status**: An√°lise Completa de Configura√ß√£o

---

## üö® PROBLEMAS IDENTIFICADOS

### 1. **Chave Public√°vel Incorreta no Runtime**

**Problema**: O storefront est√° usando `pk_dev_test` em vez da chave correta  
**Chave correta**: `pk_2786bc8945cacd335e0cd8fb17b19d2516ec4e29ed9a64ca583ebbe4bb9dc40d`  
**Evid√™ncia**: Logs mostram `"x-publishable-api-key": "pk_dev_test"`

**Impacto**:

- ‚ùå Conex√£o com backend falhando (retries infinitos)
- ‚ùå Categorias n√£o carregam
- ‚ùå Collections n√£o carregam
- ‚ùå Produtos n√£o aparecem

**Causa Raiz**: Vari√°vel de ambiente n√£o est√° sendo lida corretamente pelo container Docker

### 2. **Logos Oficiais Yello N√£o Utilizados**

**Localiza√ß√£o**: `storefront/public/`

- ‚úÖ `yello-black_logomark.png` - Logo oficial preto
- ‚úÖ `yello-white_logomark.png` - Logo oficial branco
- ‚úÖ `yello-icon.jpg` - √çcone oficial

**Problema**: Os componentes React est√£o usando SVGs gerados manualmente em vez dos logos oficiais

### 3. **Componentes de Logo Duplicados**

**Arquivos criados**:

- `src/modules/common/icons/yello-icon.tsx` - SVG manual
- `src/modules/common/icons/yello-logo-full.tsx` - SVG manual com texto
- `src/modules/common/icons/logo.tsx` - Wrapper duplicado

**Problema**: Caminhos quebrados - componentes n√£o apontam para assets oficiais

---

## üìÇ ESTRUTURA DO STOREFRONT

### Diret√≥rio Raiz

```
storefront/
‚îú‚îÄ‚îÄ .env                          # ‚úÖ Tem a chave correta
‚îú‚îÄ‚îÄ .env.template
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ next.config.js
‚îú‚îÄ‚îÄ tailwind.config.js
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ Dockerfile.dev                # ‚ö†Ô∏è Container n√£o l√™ .env corretamente
‚îú‚îÄ‚îÄ docker-compose.dev.yml
‚îî‚îÄ‚îÄ AGENTS.md                     # Instru√ß√µes para agentes
```

### Public Assets

```
public/
‚îú‚îÄ‚îÄ favicon.ico
‚îú‚îÄ‚îÄ manifest.json
‚îú‚îÄ‚îÄ yello-black_logomark.png      # üéØ Logo oficial preto
‚îú‚îÄ‚îÄ yello-white_logomark.png      # üéØ Logo oficial branco  
‚îú‚îÄ‚îÄ yello-icon.jpg                # üéØ √çcone oficial
‚îú‚îÄ‚îÄ android-chrome-192x192.png
‚îú‚îÄ‚îÄ android-chrome-512x512.png
‚îú‚îÄ‚îÄ apple-touch-icon.png
‚îú‚îÄ‚îÄ logos/
‚îÇ   ‚îú‚îÄ‚îÄ fabricantes/              # Logos de fabricantes (BYD, Huawei, etc.)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BYD_Company,_Ltd._-_Logo.svg
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Growatt.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Huawei_idfUUSTrcr_0.svg
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ JA_Solar_Logo.svg
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Trina_Solar_logo.svg
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logos_manifest.csv
‚îÇ   ‚îî‚îÄ‚îÄ parceiros/                # ‚ö†Ô∏è Vazio
‚îî‚îÄ‚îÄ videos/
```

### Source Structure (Simplificado)

```
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                # Root layout com metadata
‚îÇ   ‚îú‚îÄ‚îÄ [countryCode]/            # Rotas i18n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ (main)/              # Layout principal
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx       # Com navega√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx         # Home
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ produtos/        # Cat√°logo
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ solucoes/        # Solu√ß√µes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cotacao/         # Cota√ß√µes
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ calculadora/     # Calculadora solar
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ (checkout)/          # Checkout isolado
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îú‚îÄ‚îÄ health/              # Health check
‚îÇ       ‚îî‚îÄ‚îÄ quotes/              # API de cota√ß√µes
‚îÇ
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ account/                 # Conta do usu√°rio
‚îÇ   ‚îú‚îÄ‚îÄ cart/                    # Carrinho de compras
‚îÇ   ‚îú‚îÄ‚îÄ checkout/                # Processo de checkout
‚îÇ   ‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/          # Componentes compartilhados
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ icons/               # ‚ö†Ô∏è √çcones (problema aqui)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ logo.tsx         # Logo atual (SVG manual)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ yello-icon.tsx   # ‚ö†Ô∏è SVG manual (n√£o usa asset oficial)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ yello-logo-full.tsx # ‚ö†Ô∏è SVG manual com texto
‚îÇ   ‚îú‚îÄ‚îÄ finance/                 # M√≥dulo de financiamento
‚îÇ   ‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nav/             # Navega√ß√£o principal
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.tsx    # Usa LogoIcon
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ footer/          # Rodap√©
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ index.tsx    # Usa YelloIcon
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ lead-quote/              # Leads e cota√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ products/                # Produtos
‚îÇ   ‚îú‚îÄ‚îÄ quotes/                  # Sistema de cota√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ skeletons/               # Loading states
‚îÇ   ‚îú‚îÄ‚îÄ solar/                   # Calculadora solar
‚îÇ   ‚îî‚îÄ‚îÄ store/                   # Loja
‚îÇ
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ config.ts                # ‚úÖ L√™ NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY
‚îÇ   ‚îú‚îÄ‚îÄ data/                    # Data fetching
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cart.ts              # ‚úÖ Usa publishable key
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ categories.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ collections.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ products.ts
‚îÇ   ‚îî‚îÄ‚îÄ util/
‚îÇ       ‚îî‚îÄ‚îÄ env.ts               # Utilit√°rios de ambiente
‚îÇ
‚îú‚îÄ‚îÄ components/                  # Componentes globais
‚îÇ   ‚îú‚îÄ‚îÄ PWAProvider.tsx
‚îÇ   ‚îú‚îÄ‚îÄ SKUAutocomplete.tsx
‚îÇ   ‚îú‚îÄ‚îÄ SKUQRCode.tsx
‚îÇ   ‚îî‚îÄ‚îÄ theme/                   # Sistema de tema dark/light
‚îÇ
‚îú‚îÄ‚îÄ providers/
‚îÇ   ‚îî‚îÄ‚îÄ posthog-provider.tsx     # Analytics
‚îÇ
‚îî‚îÄ‚îÄ styles/
    ‚îî‚îÄ‚îÄ globals.css              # Estilos globais + Tailwind
```

---

## üîë CONFIGURA√á√ÉO DE AMBIENTE

### Arquivo `.env` (Correto)

```bash
NEXT_PUBLIC_MEDUSA_BACKEND_URL=http://localhost:9000
NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY=pk_2786bc8945cacd335e0cd8fb17b19d2516ec4e29ed9a64ca583ebbe4bb9dc40d
NEXT_PUBLIC_BASE_URL=http://localhost:8000
NEXT_PUBLIC_DEFAULT_REGION=br
REVALIDATE_SECRET=supersecret
```

### Onde a Chave √© Lida

1. ‚úÖ `src/lib/config.ts` - Configura√ß√£o do SDK Medusa
2. ‚úÖ `src/lib/data/cart.ts` - API de carrinho
3. ‚úÖ `src/middleware.ts` - Middleware de regi√£o
4. ‚úÖ `check-env-variables.js` - Valida√ß√£o no build

### Problema: Container Docker

O container n√£o est√° recebendo a vari√°vel de ambiente corretamente. Est√° usando fallback `pk_dev_test`.

---

## üé® SISTEMA DE LOGOS

### Logos Oficiais Dispon√≠veis (Public)

| Arquivo | Tipo | Uso Recomendado |
|---------|------|-----------------|
| `yello-black_logomark.png` | PNG | Navega√ß√£o (tema claro) |
| `yello-white_logomark.png` | PNG | Navega√ß√£o (tema escuro) |
| `yello-icon.jpg` | JPG | Favicon, PWA icons |

### Logos Fabricantes (Para P√°ginas de Produtos)

- BYD
- Canadian Solar
- Growatt
- Huawei
- JA Solar
- Trina Solar

### Componentes React Atuais (Problem√°ticos)

```typescript
// ‚ö†Ô∏è yello-icon.tsx - SVG manual (16 raios)
// Gradiente: #FDD835 ‚Üí #FF9800 ‚Üí #FF5252
const YelloIcon = () => (
  <svg viewBox="0 0 200 200">
    {/* C√≠rculo com gradiente radial */}
    {/* 16 raios brancos */}
    {/* Centro branco */}
  </svg>
)

// ‚ö†Ô∏è yello-logo-full.tsx - SVG com texto
const YelloLogoFull = () => (
  <svg viewBox="0 0 600 200">
    {/* √çcone solar */}
    {/* Texto "yello" */}
    {/* Ponto vermelho final */}
  </svg>
)

// ‚ö†Ô∏è logo.tsx - Wrapper duplicado
const LogoIcon = () => (
  /* C√≥pia do YelloIcon */
)
```

**Problema**: N√£o usam os assets oficiais em `public/`

---

## üìä M√ìDULOS PRINCIPAIS

### 1. **Solar Calculator** (`src/modules/solar/`)

- Calculadora de dimensionamento fotovoltaico
- Integra√ß√£o com API de irradia√ß√£o solar
- Gera√ß√£o de leads e cota√ß√µes

### 2. **Finance** (`src/modules/finance/`)

- Simulador de financiamento
- Integra√ß√£o com BACEN (taxa Selic)
- C√°lculo de parcelas

### 3. **Quotes** (`src/modules/quotes/`)

- Sistema de cota√ß√µes
- Hist√≥rico de cota√ß√µes
- Export para CSV/PDF

### 4. **Lead Quote** (`src/modules/lead-quote/`)

- Captura de leads
- Carrinho de cota√ß√£o
- Contexto global de lead

### 5. **Products** (`src/modules/products/`)

- Cat√°logo de produtos
- Filtros e busca
- SKU tracking

---

## üîç AN√ÅLISE DE IMPORTS

### Imports do Logo (Grep Results)

```typescript
// nav/index.tsx
import LogoIcon from "@/modules/common/icons/logo"

// footer/index.tsx  
import YelloIcon from "@/modules/common/icons/yello-icon"

// checkout (provavelmente)
import LogoIcon from "@/modules/common/icons/logo"
```

### Uso da Publishable Key

```typescript
// lib/config.ts
publishableKey: process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY

// lib/data/cart.ts
if (process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY) {
  headers["x-publishable-api-key"] = 
    process.env.NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY
}
```

---

## üõ†Ô∏è CORRE√á√ïES NECESS√ÅRIAS

### Prioridade 1: Fixar Publishable Key

**A√ß√£o**: Garantir que o container Docker recebe a vari√°vel de ambiente

```powershell
# Op√ß√£o A: Rebuild com --build-arg
docker-compose -f docker-compose.dev.yml build --build-arg NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY=pk_2786bc8945cacd335e0cd8fb17b19d2516ec4e29ed9a64ca583ebbe4bb9dc40d storefront

# Op√ß√£o B: Restart for√ßado
docker-compose -f docker-compose.dev.yml down
docker-compose -f docker-compose.dev.yml up -d

# Op√ß√£o C: Verificar .env no container
docker exec ysh-b2b-storefront-dev env | grep PUBLISHABLE
```

### Prioridade 2: Usar Logos Oficiais

**A√ß√£o**: Modificar componentes para usar assets em `public/`

```typescript
// Exemplo: Logo com tema
import Image from 'next/image'
import { useTheme } from 'next-themes'

const YelloLogo = () => {
  const { theme } = useTheme()
  const src = theme === 'dark' 
    ? '/yello-white_logomark.png'
    : '/yello-black_logomark.png'
  
  return (
    <Image 
      src={src}
      alt="Yello Solar Hub"
      width={40}
      height={40}
    />
  )
}
```

### Prioridade 3: Cleanup de Componentes

**A√ß√£o**: Remover/consolidar SVGs manuais

```bash
# Manter apenas um componente que usa assets oficiais
# Remover duplicatas: yello-icon.tsx, yello-logo-full.tsx
# Atualizar logo.tsx para usar Image next/image
```

---

## üìà M√âTRICAS DE QUALIDADE

### Cobertura de Testes

- ‚úÖ Unit tests configurados (Jest + Vitest)
- ‚úÖ Coverage reports dispon√≠veis
- ‚ö†Ô∏è Faltam testes para componentes de logo

### Performance

- ‚úÖ Next.js 15.5.4 (App Router)
- ‚úÖ Imagens otimizadas via next/image
- ‚ö†Ô∏è Logos usando SVG inline (pode cachear melhor com PNG)

### Acessibilidade

- ‚úÖ Semantic HTML
- ‚úÖ ARIA labels
- ‚ö†Ô∏è Logos precisam alt text adequado

---

## üîÑ STATUS DOS CONTAINERS

### Containers Ativos

```
ysh-b2b-storefront-dev  - UP (healthy) - Port 8000
ysh-b2b-backend-dev     - UP - Ports 9000-9002
ysh-b2b-postgres-dev    - UP (healthy) - Port 15432
ysh-b2b-redis-dev       - UP (healthy) - Port 16379
```

### Health Checks

- ‚úÖ Backend: <http://localhost:9000/health> (200 OK)
- ‚ö†Ô∏è Storefront: <http://localhost:8000> (200 OK mas com erros de API)

---

## üìù PR√ìXIMOS PASSOS

### Imediato

1. ‚úÖ **Extrair √°rvore completa** - CONCLU√çDO
2. üîÑ **Fixar publishable key no container**
3. üîÑ **Modificar componentes de logo para usar assets oficiais**
4. üîÑ **Testar tema dark/light com logos corretos**

### Curto Prazo

5. ‚è≥ Adicionar logos de fabricantes nas p√°ginas de produtos
6. ‚è≥ Criar favicon.ico a partir de yello-icon.jpg
7. ‚è≥ Otimizar PWA icons (192x192, 512x512)
8. ‚è≥ Adicionar testes para componentes de logo

### M√©dio Prazo

9. ‚è≥ Documentar uso dos logos oficiais
10. ‚è≥ Criar style guide para branding
11. ‚è≥ Implementar lazy loading para logos de fabricantes
12. ‚è≥ Adicionar logos de parceiros (pasta vazia)

---

## üéØ RESUMO EXECUTIVO

**Problemas Cr√≠ticos**:

1. ‚ùå Publishable key incorreta em runtime (bloqueador)
2. ‚ùå Logos oficiais n√£o utilizados (qualidade visual)
3. ‚ùå Componentes duplicados (manuten√ß√£o)

**Assets Dispon√≠veis**:

- ‚úÖ 3 logos oficiais Yello (preto, branco, √≠cone)
- ‚úÖ 6 logos de fabricantes
- ‚úÖ Estrutura completa de m√≥dulos

**A√ß√£o Imediata**:
Corrigir vari√°vel de ambiente no container Docker para desbloquear o storefront.

---

## üìö ARQUIVOS DE REFER√äNCIA

- **Estrutura completa**: `ARVORE_STOREFRONT_COMPLETA.txt` (84,443 linhas)
- **√çcones**: `ARVORE_STOREFRONT_ICONS.txt`
- **Credenciais**: `CREDENCIAIS_ADMIN.md`
- **Implementa√ß√£o logos**: `LOGO_YELLO_IMPLEMENTACAO.md`

---

**Gerado em**: 8 de outubro de 2025  
**Autor**: GitHub Copilot  
**Sess√£o**: Diagn√≥stico de configura√ß√£o p√≥s-implementa√ß√£o
