# An√°lise de Padroniza√ß√£o: SKUs e Modelos - Storefront YSH

**Data:** 7 de Outubro de 2025  
**Escopo:** Revis√£o completa da padroniza√ß√£o de SKUs e Models no storefront

---

## üìã Situa√ß√£o Atual

### 1. Campos de Produto Identificados

#### No ProductCard (Cat√°logo)

```typescript
interface ProductCardProps {
    product: {
        id: string           // Identificador √∫nico
        name: string         // Nome completo do produto
        sku?: string         // SKU opcional (variante)
        manufacturer?: string // Fabricante
        model?: string       // Modelo do produto
        // ... outros campos
    }
}
```

#### Na Product Variants Table (Medusa)

```typescript
{
    variant: {
        sku: string         // SKU da variante (obrigat√≥rio)
        options: []         // Op√ß√µes da variante
    }
}
```

#### No Backend (Normaliza√ß√£o)

```typescript
{
    id: string,            // ID √∫nico (geralmente baseado no SKU)
    sku: string,           // SKU do produto
    name: string,          // Nome do produto
    manufacturer: string,  // Fabricante
    model?: string,        // Modelo
    // ...
}
```

---

## üîç Problemas Identificados

### 1. **Inconsist√™ncia na Exibi√ß√£o de SKU**

**Problema:** O SKU aparece em contextos diferentes:

- ‚úÖ Na tabela de variantes (sempre exibido)
- ‚ùå No ProductCard (opcional, raramente exibido)
- ‚ö†Ô∏è No backend (usado como ID principal)

**Exemplo:**

```tsx
// ProductCard.tsx - SKU n√£o √© exibido visualmente
{product.manufacturer && (
    <p className="text-xs text-gray-500 uppercase tracking-wide">
        {product.manufacturer}
    </p>
)}
{product.model && (
    <p className="text-sm text-gray-600 font-medium">
        {product.model}
    </p>
)}
// SKU n√£o aparece aqui ‚ùå
```

**Vs.**

```tsx
// product-variants-table/index.tsx - SKU exibido
<Table.HeaderCell className="px-4">SKU</Table.HeaderCell>
<Table.Cell className="px-4">{variant.sku}</Table.Cell>
```

### 2. **Duplica√ß√£o: Model vs Name**

**Problema:** Confus√£o entre `model` e `name`:

```typescript
// Alguns produtos t√™m:
{
    name: "Painel Solar 550W Monocristalino PERC",
    model: "CS7L-550MS",
    manufacturer: "Canadian Solar"
}

// Outros t√™m tudo no nome:
{
    name: "Canadian Solar CS7L-550MS 550W Monocristalino PERC",
    model: undefined,
    manufacturer: "Canadian Solar"
}
```

### 3. **SKU vs ID Inconsist√™ncia**

**Problema:** Backend usa SKU como ID, mas nem sempre s√£o os mesmos:

```typescript
// backend/src/api/store/catalog/search/route.ts
const base: any = {
    id: raw.id || raw.sku,  // ‚ö†Ô∏è Pode ser diferente
    sku: raw.sku,
    // ...
}
```

### 4. **Falta de Padr√£o Visual**

Atualmente, n√£o h√° um formato visual consistente para exibir:

- SKU do produto
- Modelo do fabricante
- C√≥digo de refer√™ncia

---

## ‚úÖ Recomenda√ß√µes de Padroniza√ß√£o

### 1. **Estrutura de Dados Padronizada**

```typescript
interface StandardizedProduct {
    // Identificadores
    id: string                    // ID √∫nico do sistema (nunca muda)
    sku: string                   // SKU comercial (pode ser do fabricante ou distribuidor)
    internal_sku?: string         // SKU interno YSH (se diferente)
    
    // Informa√ß√µes do Produto
    name: string                  // Nome descritivo completo
    manufacturer: string          // Fabricante (ex: "Canadian Solar", "Growatt")
    model: string                 // Modelo do fabricante (ex: "CS7L-550MS", "MID-25KTL3-X")
    series?: string               // S√©rie do produto (ex: "HiKu7", "TopHiKu")
    
    // Classifica√ß√£o
    category: string              // Categoria principal
    subcategory?: string          // Subcategoria espec√≠fica
    
    // Pricing & Availability
    price_brl: number
    availability: boolean
    
    // Metadata
    metadata: {
        original_sku?: string     // SKU original do distribuidor
        distributor: string       // Fonte do produto
        last_updated: string
    }
}
```

### 2. **Padr√£o de Exibi√ß√£o Visual**

#### ProductCard (Cat√°logo)

```tsx
<div className="product-card">
    {/* Cabe√ßalho */}
    <div className="product-header">
        <span className="manufacturer">{manufacturer}</span>
        <span className="model">{model}</span>
    </div>
    
    {/* Nome do Produto */}
    <h3 className="product-name">{name}</h3>
    
    {/* SKU (sempre vis√≠vel) */}
    <div className="product-sku">
        <span className="label">SKU:</span>
        <span className="value">{sku}</span>
    </div>
    
    {/* Especifica√ß√µes */}
    <div className="product-specs">
        {/* specs aqui */}
    </div>
</div>
```

#### Product Detail Page

```tsx
<div className="product-detail-header">
    <div className="breadcrumb">
        {category} > {subcategory} > {manufacturer}
    </div>
    
    <h1 className="product-title">
        {manufacturer} {model} - {name}
    </h1>
    
    <div className="product-identifiers">
        <div className="identifier-group">
            <label>SKU:</label>
            <code>{sku}</code>
            <button onClick={copyToClipboard}>üìã</button>
        </div>
        
        {internal_sku && (
            <div className="identifier-group">
                <label>Ref. Interna:</label>
                <code>{internal_sku}</code>
            </div>
        )}
        
        <div className="identifier-group">
            <label>Modelo:</label>
            <span>{model}</span>
        </div>
    </div>
</div>
```

### 3. **Conven√ß√£o de Nomenclatura**

#### Para SKUs

```
Formato: [DISTRIBUTOR]-[CATEGORY]-[MANUFACTURER]-[MODEL]-[VARIANT]

Exemplos:
- NEOSOLAR-PANEL-CANADIAN-CS7L550MS-MONO
- FOTUS-KIT-CANADIAN-5KWP-CERAMIC
- SOLFACIL-INV-GROWATT-MID25KTL3X-TRI
```

#### Para Models

```
Formato: Usar exatamente como especificado pelo fabricante

Exemplos corretos:
‚úÖ CS7L-550MS (Canadian Solar)
‚úÖ MID-25KTL3-X (Growatt)
‚úÖ SUN-5K-G03 (Deye)

Exemplos incorretos:
‚ùå cs7l550ms (sem formata√ß√£o)
‚ùå CS7L 550MS (espa√ßamento errado)
‚ùå Canadian Solar 550W (n√£o √© o modelo)
```

### 4. **Migra√ß√£o e Normaliza√ß√£o**

#### Script de Normaliza√ß√£o de SKUs

```python
def normalize_sku(raw_sku: str, category: str, manufacturer: str, model: str) -> str:
    """
    Normaliza SKU para o padr√£o YSH
    """
    # Remover caracteres especiais
    clean_sku = re.sub(r'[^A-Z0-9\-]', '', raw_sku.upper())
    
    # Se j√° est√° no formato correto, retornar
    if clean_sku.count('-') >= 3:
        return clean_sku
    
    # Construir SKU padronizado
    category_code = CATEGORY_CODES.get(category, 'PROD')
    manufacturer_code = MANUFACTURER_CODES.get(manufacturer, manufacturer[:4].upper())
    model_code = model.replace(' ', '-').upper()
    
    return f"YSH-{category_code}-{manufacturer_code}-{model_code}"

# Exemplo de uso:
# Input: "FOTUS-KP-113kWp-Ceramico-kits"
# Output: "YSH-KIT-FOTUS-113KWP-CERAMIC"
```

### 5. **Componentes React Padronizados**

#### ProductSKU Component

```tsx
interface ProductSKUProps {
    sku: string
    internal_sku?: string
    copyable?: boolean
    size?: 'sm' | 'md' | 'lg'
}

const ProductSKU = ({ sku, internal_sku, copyable = true, size = 'md' }: ProductSKUProps) => {
    const [copied, setCopied] = useState(false)
    
    const handleCopy = () => {
        navigator.clipboard.writeText(sku)
        setCopied(true)
        setTimeout(() => setCopied(false), 2000)
    }
    
    return (
        <div className={`product-sku product-sku-${size}`}>
            <span className="sku-label">SKU:</span>
            <code className="sku-value">{sku}</code>
            {copyable && (
                <button 
                    onClick={handleCopy}
                    className="sku-copy-btn"
                    title="Copiar SKU"
                >
                    {copied ? '‚úì' : 'üìã'}
                </button>
            )}
            {internal_sku && (
                <span className="sku-internal" title="Refer√™ncia Interna">
                    (Ref: {internal_sku})
                </span>
            )}
        </div>
    )
}
```

#### ProductModel Component

```tsx
interface ProductModelProps {
    manufacturer: string
    model: string
    series?: string
    link?: boolean
}

const ProductModel = ({ manufacturer, model, series, link = false }: ProductModelProps) => {
    const content = (
        <div className="product-model">
            <span className="manufacturer">{manufacturer}</span>
            <span className="model-separator">‚Ä∫</span>
            <span className="model-code">{model}</span>
            {series && (
                <>
                    <span className="model-separator">‚Ä¢</span>
                    <span className="model-series">{series}</span>
                </>
            )}
        </div>
    )
    
    if (link) {
        return (
            <Link href={`/produtos?manufacturer=${manufacturer}&model=${model}`}>
                {content}
            </Link>
        )
    }
    
    return content
}
```

---

## üéØ Plano de Implementa√ß√£o

### Fase 1: Backend (1-2 dias)

1. ‚úÖ Criar script de normaliza√ß√£o de SKUs
2. ‚úÖ Atualizar schemas com campos padronizados
3. ‚úÖ Migrar dados existentes
4. ‚úÖ Validar integridade dos dados

### Fase 2: API (1 dia)

1. ‚úÖ Garantir que API sempre retorna `sku`, `model`, `manufacturer`
2. ‚úÖ Adicionar endpoint de busca por SKU
3. ‚úÖ Documentar estrutura de dados

### Fase 3: Componentes UI (2-3 dias)

1. ‚úÖ Criar `ProductSKU` component
2. ‚úÖ Criar `ProductModel` component
3. ‚úÖ Atualizar `ProductCard` para exibir SKU
4. ‚úÖ Atualizar product detail pages
5. ‚úÖ Adicionar estilos CSS

### Fase 4: Testing & QA (1 dia)

1. ‚úÖ Testar exibi√ß√£o em diferentes categorias
2. ‚úÖ Validar funcionalidade de copiar SKU
3. ‚úÖ Testar busca por SKU
4. ‚úÖ Revisar acessibilidade

---

## üìä M√©tricas de Sucesso

- ‚úÖ 100% dos produtos t√™m SKU √∫nico e v√°lido
- ‚úÖ 100% dos produtos exibem SKU de forma consistente
- ‚úÖ Model e Manufacturer sempre preenchidos quando dispon√≠veis
- ‚úÖ Zero ambiguidade entre ID, SKU e Model
- ‚úÖ Busca por SKU funciona em todos os contextos

---

## üîß Arquivos a Modificar

### Storefront

```
storefront/src/modules/catalog/components/
‚îú‚îÄ‚îÄ ProductCard.tsx                    # ‚úÖ Adicionar exibi√ß√£o de SKU
‚îú‚îÄ‚îÄ ProductSKU.tsx                     # ‚úÖ CRIAR - Novo componente
‚îú‚îÄ‚îÄ ProductModel.tsx                   # ‚úÖ CRIAR - Novo componente
‚îî‚îÄ‚îÄ EnrichedProductCard.tsx            # ‚úÖ Atualizar para usar novos componentes

storefront/src/modules/products/
‚îú‚îÄ‚îÄ templates/product-info/index.tsx   # ‚úÖ Adicionar SKU e Model
‚îî‚îÄ‚îÄ components/product-variants-table/ # ‚úÖ J√° exibe SKU corretamente

storefront/src/lib/api/
‚îú‚îÄ‚îÄ fallback.ts                        # ‚úÖ Garantir normaliza√ß√£o
‚îî‚îÄ‚îÄ validation.ts                      # ‚úÖ Adicionar valida√ß√£o de SKU
```

### Backend

```
backend/src/api/store/
‚îú‚îÄ‚îÄ catalog/search/route.ts            # ‚úÖ Normalizar SKU na resposta
‚îî‚îÄ‚îÄ products.custom/[id]/route.ts      # ‚úÖ Garantir campos obrigat√≥rios

backend/src/scripts/
‚îî‚îÄ‚îÄ normalize-product-skus.ts          # ‚úÖ CRIAR - Script de normaliza√ß√£o
```

---

## üìù Observa√ß√µes Importantes

### Compatibilidade com Medusa

- Medusa usa `variant.sku` para variantes
- Produto base pode ter `sku` ou usar `id`
- Nossa implementa√ß√£o deve manter compatibilidade

### Distribuidores

- Cada distribuidor tem seu pr√≥prio formato de SKU
- Precisamos mapear e normalizar internamente
- Manter refer√™ncia ao SKU original em metadata

### Busca e Filtros

- Busca deve funcionar por SKU normalizado E original
- Filtros devem permitir busca por fabricante + modelo
- Suporte a busca fuzzy para modelos similares

---

## ‚ú® Benef√≠cios da Padroniza√ß√£o

1. **Experi√™ncia do Usu√°rio**
   - Facilita busca e compara√ß√£o de produtos
   - SKU sempre vis√≠vel e copi√°vel
   - Modelo do fabricante claramente identificado

2. **Operacional**
   - Integra√ß√£o mais f√°cil com distribuidores
   - Menos erros em pedidos
   - Melhor rastreabilidade

3. **T√©cnico**
   - C√≥digo mais limpo e manuten√≠vel
   - Menos bugs relacionados a identifica√ß√£o
   - API mais previs√≠vel

4. **Neg√≥cio**
   - Melhor SEO (structured data)
   - Facilita analytics
   - Suporte ao cliente mais eficiente

---

**Status:** üìã An√°lise completa  
**Pr√≥ximo passo:** Implementar Fase 1 (Backend)
